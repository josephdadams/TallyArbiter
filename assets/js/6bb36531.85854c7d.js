"use strict";(self.webpackChunktallyarbiter_docs=self.webpackChunktallyarbiter_docs||[]).push([[301],{3870:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"usage/sections/mqtt","title":"MQTT","description":"Tally Arbiter can publish device tally states to an MQTT broker, enabling integration with home automation systems like Home Assistant, openHAB, Node-RED, and other IoT platforms. This allows you to monitor and react to tally states in real-time through your smart home or automation setup.","source":"@site/docs/usage/sections/mqtt.md","sourceDirName":"usage/sections","slug":"/usage/sections/mqtt","permalink":"/TallyArbiter/docs/usage/sections/mqtt","draft":false,"unlisted":false,"editUrl":"https://github.com/josephdadams/TallyArbiter/edit/master/docs/docs/usage/sections/mqtt.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Configuring and Using Tally Arbiter Cloud","permalink":"/TallyArbiter/docs/usage/sections/cloud"},"next":{"title":"Troubleshooting","permalink":"/TallyArbiter/docs/usage/troubleshooting"}}');var i=t(4848),r=t(8453);const l={sidebar_position:6},o="MQTT",a={},c=[{value:"Configuration",id:"configuration",level:2},{value:"Required Settings",id:"required-settings",level:3},{value:"Optional Settings",id:"optional-settings",level:3},{value:"Example Configuration",id:"example-configuration",level:3},{value:"MQTT Topics",id:"mqtt-topics",level:2},{value:"Service Status",id:"service-status",level:3},{value:"Device State Topics",id:"device-state-topics",level:3},{value:"Topic Examples",id:"topic-examples",level:3},{value:"Home Assistant Integration",id:"home-assistant-integration",level:2},{value:"Example Home Assistant Configuration",id:"example-home-assistant-configuration",level:3},{value:"Home Assistant Automation Example",id:"home-assistant-automation-example",level:3},{value:"Node-RED Integration",id:"node-red-integration",level:2},{value:"Connection Management",id:"connection-management",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mqtt",children:"MQTT"})}),"\n",(0,i.jsx)(n.p,{children:"Tally Arbiter can publish device tally states to an MQTT broker, enabling integration with home automation systems like Home Assistant, openHAB, Node-RED, and other IoT platforms. This allows you to monitor and react to tally states in real-time through your smart home or automation setup."}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"MQTT can be configured through the Tally Arbiter settings interface or by editing the configuration file directly. The MQTT configuration section includes the following options:"}),"\n",(0,i.jsx)(n.h3,{id:"required-settings",children:"Required Settings"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enabled"}),": Enable or disable the MQTT integration (default: ",(0,i.jsx)(n.code,{children:"false"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Broker"}),": MQTT broker hostname or IP address (default: ",(0,i.jsx)(n.code,{children:"localhost"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port"}),": MQTT broker port (default: ",(0,i.jsx)(n.code,{children:"1883"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topic Prefix"}),": Prefix for all MQTT topics (default: ",(0,i.jsx)(n.code,{children:"tallyarbiter"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Retain"}),": Whether to retain MQTT messages (default: ",(0,i.jsx)(n.code,{children:"true"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"QoS"}),": Quality of Service level - ",(0,i.jsx)(n.code,{children:"0"}),", ",(0,i.jsx)(n.code,{children:"1"}),", or ",(0,i.jsx)(n.code,{children:"2"})," (default: ",(0,i.jsx)(n.code,{children:"0"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"optional-settings",children:"Optional Settings"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Username"}),": MQTT broker username (if authentication is required)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Password"}),": MQTT broker password (if authentication is required)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reconnect Period"}),": Time in milliseconds between reconnection attempts (default: ",(0,i.jsx)(n.code,{children:"5000"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connect Timeout"}),": Connection timeout in milliseconds (default: ",(0,i.jsx)(n.code,{children:"10000"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Keepalive"}),": Keepalive interval in seconds (default: ",(0,i.jsx)(n.code,{children:"60"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Client ID"}),": Custom MQTT client ID (auto-generated if not provided)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n\t"mqtt": {\n\t\t"enabled": true,\n\t\t"broker": "192.168.1.100",\n\t\t"port": 1883,\n\t\t"username": "tallyarbiter",\n\t\t"password": "your_password",\n\t\t"topicPrefix": "tallyarbiter",\n\t\t"retain": true,\n\t\t"qos": 1,\n\t\t"reconnectPeriod": 5000,\n\t\t"connectTimeout": 10000,\n\t\t"keepalive": 60\n\t}\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"mqtt-topics",children:"MQTT Topics"}),"\n",(0,i.jsx)(n.p,{children:"Tally Arbiter publishes device states to several MQTT topics following a structured hierarchy:"}),"\n",(0,i.jsx)(n.h3,{id:"service-status",children:"Service Status"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"{topicPrefix}/status"})}),": Overall service status (",(0,i.jsx)(n.code,{children:"online"})," or ",(0,i.jsx)(n.code,{children:"offline"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"device-state-topics",children:"Device State Topics"}),"\n",(0,i.jsx)(n.p,{children:"For each device, Tally Arbiter publishes:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"{topicPrefix}/device/{deviceId}/state"})}),": Complete device state as JSON"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n\t"deviceId": "device-123",\n\t"deviceName": "Camera 1",\n\t"states": [\n\t\t{\n\t\t\t"busId": "bus-1",\n\t\t\t"busLabel": "Program",\n\t\t\t"sources": ["source-1", "source-2"]\n\t\t}\n\t],\n\t"timestamp": "2024-01-15T10:30:00.000Z"\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"{topicPrefix}/device/{deviceId}/bus/{busId}"})}),": Individual bus state as JSON"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n\t"state": "ON",\n\t"busId": "bus-1",\n\t"busLabel": "Program",\n\t"busType": "program",\n\t"busColor": "#ff0000",\n\t"sources": ["source-1"],\n\t"timestamp": "2024-01-15T10:30:00.000Z"\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"{topicPrefix}/device/{deviceId}/bus/{busId}/state"})}),": Simple bus state (",(0,i.jsx)(n.code,{children:"ON"})," or ",(0,i.jsx)(n.code,{children:"OFF"}),")"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"This topic contains just the state string, making it ideal for Home Assistant binary sensors"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"{topicPrefix}/device/{deviceId}/status"})}),": Device availability status (",(0,i.jsx)(n.code,{children:"online"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"topic-examples",children:"Topic Examples"}),"\n",(0,i.jsxs)(n.p,{children:["With the default topic prefix ",(0,i.jsx)(n.code,{children:"tallyarbiter"})," and a device ID ",(0,i.jsx)(n.code,{children:"camera-1"})," with bus ID ",(0,i.jsx)(n.code,{children:"program-bus"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tallyarbiter/status"})," - Service status"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tallyarbiter/device/camera-1/state"})," - Complete device state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tallyarbiter/device/camera-1/bus/program-bus"})," - Program bus state (JSON)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tallyarbiter/device/camera-1/bus/program-bus/state"})," - Program bus state (ON/OFF)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tallyarbiter/device/camera-1/status"})," - Device availability"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"home-assistant-integration",children:"Home Assistant Integration"}),"\n",(0,i.jsx)(n.p,{children:"The MQTT integration is designed to work seamlessly with Home Assistant. You can create binary sensors, sensors, and automations based on tally states."}),"\n",(0,i.jsx)(n.h3,{id:"example-home-assistant-configuration",children:"Example Home Assistant Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# binary_sensor.yaml\n- platform: mqtt\n  name: 'Camera 1 Program Tally'\n  state_topic: 'tallyarbiter/device/camera-1/bus/program-bus/state'\n  payload_on: 'ON'\n  payload_off: 'OFF'\n  device_class: running\n\n# sensor.yaml\n- platform: mqtt\n  name: 'Camera 1 Tally State'\n  state_topic: 'tallyarbiter/device/camera-1/state'\n  value_template: \"{{ value_json.states[0].busLabel if value_json.states else 'Clear' }}\"\n  json_attributes_topic: 'tallyarbiter/device/camera-1/state'\n  json_attributes_template: '{{ value_json | tojson }}'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"home-assistant-automation-example",children:"Home Assistant Automation Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# automation.yaml\n- alias: 'Turn on studio lights when camera 1 is on program'\n  trigger:\n    - platform: mqtt\n      topic: 'tallyarbiter/device/camera-1/bus/program-bus/state'\n      payload: 'ON'\n  action:\n    - service: light.turn_on\n      target:\n        entity_id: light.studio_lights\n"})}),"\n",(0,i.jsx)(n.h2,{id:"node-red-integration",children:"Node-RED Integration"}),"\n",(0,i.jsx)(n.p,{children:"You can use Node-RED to subscribe to MQTT topics and create custom automations:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Add an MQTT In node"}),"\n",(0,i.jsxs)(n.li,{children:["Configure it to subscribe to ",(0,i.jsx)(n.code,{children:"tallyarbiter/device/+/bus/+/state"})," (using wildcards)"]}),"\n",(0,i.jsx)(n.li,{children:"Process the messages in your flow"}),"\n",(0,i.jsx)(n.li,{children:"Trigger actions based on tally states"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tally Arbiter automatically reconnects to the MQTT broker if the connection is lost"}),"\n",(0,i.jsx)(n.li,{children:"The reconnection period is configurable (default: 5 seconds)"}),"\n",(0,i.jsx)(n.li,{children:"Connection status is logged in the Tally Arbiter console"}),"\n",(0,i.jsxs)(n.li,{children:["When the service starts, it publishes an ",(0,i.jsx)(n.code,{children:"online"})," status and all current device states"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enable message retention"})," if you want new subscribers to receive the last known state immediately"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use a unique topic prefix"})," if running multiple Tally Arbiter instances"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Secure your MQTT broker"})," with authentication when exposing it to a network"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Monitor the connection"})," - check the Tally Arbiter logs for connection status"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No messages received"}),": Check that MQTT is enabled in the configuration and the broker address/port are correct"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Connection failures"}),": Verify network connectivity and broker credentials"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Missing device states"}),": Ensure devices are configured and have sources assigned"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Check logs"}),": Tally Arbiter logs MQTT connection events and errors to help diagnose issues"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var s=t(6540);const i={},r=s.createContext(i);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);